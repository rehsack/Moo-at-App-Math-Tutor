\documentclass[ngerman,xcolor={table,dvipsnames},smaller,compress,hyperref={bookmarks,colorlinks}]{beamer}

\usepackage{url}
\usepackage{listings}
\usepackage[latin9]{inputenc}
\usepackage{textcomp}
%\usepackage{auto-pst-pdf}
\usepackage{graphicx}
\usepackage{pstricks}
\usepackage{pst-node}
\usepackage{pst-uml}
\usepackage{pst-tree}

\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsmath}

% for multipage tables (xtab or longtable
\usepackage{longtable}
\usepackage{lscape}
\usepackage{booktabs}
\usepackage[tableposition=top]{caption}

\title{Moo in practice - App::Math::Tutor}
\author{Jens Rehsack}
\institute[Niederrhein.PM]{Niederrhein Perl Mongers}
\date{2014}

\usetheme[secheader]{Boadilla}
\setbeamertemplate{navigation symbols}{}

\newcommand{\perlfilename}[1]{{\color{cyan}{\textit{\begingroup \urlstyle{sf}\Url{#1}}}}}
\newcommand{\xsfilename}[1]{{\color{olive}{\textit{\begingroup \urlstyle{sf}\Url{#1}}}}}
\newcommand{\hfilename}[1]{{\color{olive}{\textit{\begingroup \urlstyle{sf}\Url{#1}}}}}
\newcommand{\cfilename}[1]{{\color{magenta}{\textit{\begingroup \urlstyle{sf}\Url{#1}}}}}

\makeatletter
\makeatother

\begin{document}

\psset{angleA=90,angleB=-90}
\lstset{language=Perl,
        basicstyle=\ttfamily,
        keywordstyle=\color{Maroon},
        commentstyle=\color{Blue}, 
        stringstyle=\color{Green},
        showstringspaces=false}

\AtBeginPart{\begin{frame}<beamer> \frametitle{Overview} \partpage \tableofcontents[current] \end{frame}}

\frame{\maketitle}

\part{Introduction}

\section{Introduction}

\subsection{Audience}

\begin{frame}[t,fragile]{Audience}
\begin{block}<1->{Audience}
\begin{itemize}
\item Developer who wants to create or improve Perl5 software
\item Developer who wants to learn how to develop modern OO with Perl5
\item Developer who're interested in developing mathematical exercises
\end{itemize}
\end{block}

\begin{block}<2->{Prerequisites of the Audience}
Following knowledge is expected:
\begin{itemize}
\item General knowledge about object oriented programming or concepts like
    \small
    \begin{itemize}
    \item classes
    \item objects
    \item polymorphism, inheritance and/or roles
    \item methods, class fcuntions
    \item attributes, properties
    \end{itemize}
    \normalsize
\item slightly above basic Perl experience
\uncover<3->{\item ever heard of Smalltalk and its OO-concept is a strong bonus}
\end{itemize}
\end{block}
\end{frame}

\subsection{Motivation}

\begin{frame}[t,fragile]{Motivation}

\begin{block}<1->{Moo and App::Math::Tutor}
\begin{itemize}
\item real world examples over far-fetched conceptuals
\item MooX::Cmd, MooX::Options and MooX::ConfigFromFile provide way more features and flexibility than either
      \begin{itemize}
      \item App::Cmd with Getopt::Long::Descriptive
      \item MooseX::App::Cmd along with corresponding MooseX warppers around related stuff
      \end{itemize}
\item $ 2^{nd} $ generation of modern OO in Perl5
\end{itemize}
\end{block}

\begin{block}<2->{App::Math::Tutor}
\begin{itemize}
\item Allow parents help their children improving their mathematical skills
\item Add support for exercise types as children require
\item provide extensible design to allow easy augment of exercise
\uncover<3->{\item \textbf{Goal:} Improve to Web-Service, eg. by mapping MooX::Cmd to URI path and MooX::Options to GET parameters}
\end{itemize}
\end{block}

\end{frame}

\part{Moo basics}

\section{Modules}

\subsection{Classes and Roles}

\begin{frame}[t,fragile]

\begin{block}<1->{Classes in Moo}
\begin{itemize}
\item classes can be instantiated
\uncover<2->{\item one can inherit from classes}
\uncover<3->{\item one can aggregate classes}
\uncover<4->{\item distinguish naming conflicts is up to developer}
\end{itemize}
\end{block}

\begin{block}<5->{}
\scriptsize
\begin{lstlisting}[language=Perl,inputencoding=latin9,escapeinside={(*@}{@*)}]
{
    package Natural;

    use Moo;

    sub _stringify { ... };
}
{
    package Roman;

    use Moo;
    extends "Natural";

    sub _stringify { ... };
}
my $natnum = Natural->new( value => 42 ); say $natnum->_stringify(); # 42
my $romnum = Roman->new( value => 42 ); say $romnum->_stringify(); # XLII
\end{lstlisting}
\end{block}

\end{frame}

\begin{frame}[t,fragile]

\begin{block}<1->{Roles in Moo}
\begin{itemize}
\item roles describe a dedicated behavior (eg. \texttt{printable})
\uncover<2->{\item roles can be composed into classes}
\uncover<3->{\item one can't inherit from roles - only consumed}
\uncover<4->{\item roles cannot exist stand-alone}
\uncover<5->{\item roles are consumed once}
\uncover<6->{\item naming conflicts cause compile time error}
\end{itemize}
\end{block}

\begin{block}<7->{}
\scriptsize
\begin{lstlisting}[language=Perl,inputencoding=latin9,escapeinside={(*@}{@*)}]
{   package Printable;

    use Moo::Role; # now it's a role - no is a relationship anymore

    sub print { my $self = shift; say $self->_stringify }
}
{    package Natural;

    use Moo; # class
    with "Printable"; # consumes a role

    sub _stringify { ... };
}
my $natnum = Natural->new( value => 42 ); $natnum->print; # 42
my $romnum = Roman->new( value => 42 ); $romnum->print; # XLII
\end{lstlisting}
\end{block}

\end{frame}

\section{Attributes}

\subsection{Attributes in Moo}

\begin{frame}[t,fragile]

\begin{block}<1->{Attributes in Moo}
\begin{lstlisting}[language=Perl,inputencoding=latin9,escapeinside={(*@}{@*)}]
package VulFrac;

use Moo;

has(*@\pnode(0,0){A}{}@*) nume(*@\pnode(0,0){B}{}@*)rator => ( is => "(*@\pnode(0,0){D}{}@*)ro", (*@\pnode(0,0){F}{}@*)required => 1 );
has denom(*@\pnode(0,0){C}{}@*)inator => ( is => "(*@\pnode(0,0){E}{}@*)ro", required => (*@\pnode(0,0){G}{}@*)1 );

1;
\end{lstlisting}
\end{block}

\begin{itemize}
\uncover<2->{\item use \rnode{a}{"has"} keyword to define a attribute}
\uncover<3->{\item attributes \rnode{b}{"numerator"} and \rnode{c}{"denominator"}}
\uncover<4->{\item attributes are \rnode{d}{immutable} \uncover<5->{and \rnode{f}{required}}}
\uncover<2>{\nccurve[linecolor=olive]{->}{a}{A}}
\uncover<3>{\nccurve[linecolor=teal]{->}{b}{B}\nccurve[linecolor=teal]{->}{c}{C}}
\uncover<4>{\nccurve[linecolor=blue]{->}{d}{D}\nccurve[linecolor=blue]{->}{d}{E}}
\uncover<5>{\nccurve[linecolor=cyan]{->}{f}{F}\nccurve[linecolor=cyan]{->}{f}{G}}
\end{itemize}

\end{frame}

\subsection{Attribute Options}

\begin{frame}[t,fragile]

\begin{block}<1->{Attribute options I}
\begin{description}
\item[is] \textbf{required} behavior description
    \begin{description}
    \uncover<2->{\item[ro] defines the attribute is read only}
    \uncover<3->{\item[rw] defined the attribute is read-/writable}
    \uncover<4->{\item[lazy] defines the attribute is read only with a lazy initialization}
    \uncover<5->{\item[rwp] defines the attribute being read only for public and read-/writable for private use}
    \end{description}
\uncover<6->{\item[required] when set to a true value, attribute must be passed on instantiation}
\uncover<7->{\item[isa] defines a subroutine (\texttt{coderef}) which is called to validate values to set}
\uncover<8->{\item[coerce] defines a subrouting (\texttt{coderef}) which forces attribute values}
\uncover<9->{\item[trigger] takes a subroutine (\texttt{coderef}) which called anytime the attribute is set \\
    \uncover<10->{\textbf{special}: the value of $ 1 $ means to generate a (\texttt{coderef}) which calles the method \texttt{\_trigger\_\$\{attr\_name\}} (This is called \textit{attribute shortcut})}}
\uncover<11->{\item[handles] defines a \textbf{role} or methods to dispatch to the attribute}
\end{description}
\end{block}

\end{frame}

\begin{frame}[t,fragile]

\begin{block}<1->{Attribute options II}
\begin{description}[style=sameline]
\item[default] subroutine (\texttt{coderef}) which is called to initialize an attribute
\uncover<2->{\item[builder] takes a method name (\texttt{string}) which is called to initialize an attribute (supports \textit{attribute shortcut})}
\uncover<3->{\item[init\_arg] Takes the name of the key to look for at instantiation time of the object. A common use of this is to make an underscored attribute have a non-underscored initialization name. undef means that passing the value in on instantiation is ignored.}
\uncover<4->{\item[reader/writer] takes a method name for another than default getter name (\texttt{\_get\_\$\{attr\_name\}} or \texttt{\_set\_\$\{attr\_name\}}, respectively --- instead of \texttt{\$\{attr\_name\}} to get some Java or C++ smell)}
\uncover<5->{\item[clearer] takes a method name (\texttt{string}) which will clear the attribute (supports \textit{attribute shortcut})}
\uncover<6->{\item[predicate] takes a method name (\texttt{string}) which will return true if an attribute has a value (supports \textit{attribute shortcut})}
\end{description}
\end{block}

\end{frame}

\section{Methods}

\subsection{Method Examples}

\begin{frame}[t,fragile]

\begin{columns}[t]
\begin{column}{.8\textwidth}
\begin{block}{Methods in Moo I}
\scriptsize
\begin{lstlisting}[language=Perl,inputencoding=latin9,escapeinside={(*@}{@*)}]
package VulFrac;

use Moo;
use overload '""'   => "_stringify(*@\pnode(0,0){A}{}@*)",
             '0+'   => "_numify",
             'bool' => sub { 1 },
             '<=>'  => "_num_compare";

has numerator => ( is => "ro", required => 1 );
has denominator => ( is => "ro", required => 1,
  isa => sub { $_[0] != 0 or die "Not != 0" };

sub _stringify { my $self = shift;
  return sprintf("\\frac{%s}{%s}",
  $self->numerator, $self->denominator); }

sub _numify { $_[0]->numerator / $_[0]->denominator; }
...
\end{lstlisting}
\end{block}
\end{column}

\begin{column}{.18\textwidth}
\uncover<2->{\begin{figure}[ht]
\rnode{a}{\includegraphics[width=\textwidth]{getStringFromObj.eps}}
\caption{\small{For Wendy \& Java developers - what does operator overloading mean?}}
\end{figure}}
\end{column}
\end{columns}

\uncover<2->{\nccurve[linecolor=red]{->}{A}{a}}
\end{frame}

\begin{frame}[t,fragile]

\begin{block}<1->{Methods in Moo II}
\scriptsize
\begin{lstlisting}[language=Perl,inputencoding=latin9,escapeinside={(*@}{@*)}]
package Rationale;

use Moo;

extends "VulFrac";

has digits => ( is => "ro", required => 1 );

sub _stringify {
  my $digits = $_[0]->digits;
  sprintf("%.${digits}g", $_[0]->_numify); }

\end{lstlisting}
\end{block}

\onslide<2->{
\begin{itemize}
\item nothing like \texttt{MooseX::Declare} - pure Perl5 keywords are enough for plain methods
\end{itemize}
}

\end{frame}

\subsection{Method Modifiers}

\begin{frame}[t,fragile]

\begin{block}<1->{Method Modifiers}
Method modifiers are a convenient feature from the CLOS (Common Lisp Object System) world:
\begin{description}
\uncover<2->{\item[before] \texttt{before method(s) => sub \{ \ldots \}} \\
before is called before the method it is modifying. Its return value is totally ignored.}
\uncover<3->{\item[after] \texttt{after method(s) => sub \{ \ldots \}} \\
after is called after the method it is modifying. Its return value is totally ignored.}
\uncover<4->{\item[around] \texttt{around method(s) => sub \{ \ldots \}} \\
around is called instead of the method it is modifying. The method you're overriding is passed as \texttt{coderef} in the first argument.}
\uncover<5->{\item[-] No support for \texttt{super}, \texttt{override}, \texttt{inner} or \texttt{augment}}
\end{description}
\end{block}

\end{frame}

\begin{frame}[t,fragile]

\begin{block}<1->{Method Modifiers - Advantages}
\begin{itemize}
\item supersedes \texttt{\$self->SUPER::foo(@\_)} syntax
\uncover<2->{\item cleaner interface than SUPER}
\uncover<3->{\item allows multiple modifiers in single namespace}
\uncover<4->{\item also possible from within roles and not restricted to inheritance}
\uncover<5->{\item ensures that inherited methods invocation happens right (mostly - remember around)}
\end{itemize}
\end{block}

\end{frame}

\begin{frame}[t,fragile]

\begin{block}<1->{Methods Modifiers - around avoid calling \texttt{\$orig}}
\scriptsize
\begin{lstlisting}[language=Perl,inputencoding=latin9,escapeinside={(*@}{@*)}]
package App::Math::Tutor::Role::Roman;

use Moo::Role;

with "App::Math::Tutor::Role::Natural";

{ package RomanNum;
  use Moo;
  extends "NatNum"; # derives overloading!
  sub _stringify { ... } }

around "_guess_natural_number" => sub {
    my $orig    = shift;
    my $max_val = $_[0]->format;
    my $value   = int( rand( $max_val - 1 ) ) + 1;
    return RomanNum->new( value => $value );
};
\end{lstlisting}
\end{block}

\begin{itemize}
\uncover<2->{\item captures control}
\uncover<3->{\item receives responsibility}
\uncover<4->{\item runtime of modified method completely eliminated}
\end{itemize}

\end{frame}

\begin{frame}[t,fragile]

\begin{block}<1->{Methods Modifiers - around modifying \texttt{\$orig} return value}
\scriptsize
\begin{lstlisting}[language=Perl,inputencoding=latin9,escapeinside={(*@}{@*)}]
package App::Math::Tutor::Role::Roman;

use Moo::Role;

with "App::Math::Tutor::Role::Natural";

{ package RomanNum;
  use Moo;
  extends "NatNum"; # derives overloading!
  sub _stringify { ... } }

around "_guess_natural_number" => sub {
    my $orig = shift;
    my $num  = $orig->(@_);
    return RomanNum->new( value => $num->value );
};
\end{lstlisting}
\end{block}

\begin{itemize}
\uncover<2->{\item modifies only required part}
\uncover<3->{\item leaves most responsibility in modified method}
\uncover<4->{\item runtime of modified method added to this method's runtime}
\end{itemize}

\end{frame}

\part{Math Tutor}

\section{Structure}

\subsection{Frontend}

\begin{frame}[t,fragile]

\begin{block}<1->{Frontend (dictated by MooX::Cmd)}
\scriptsize
\def\psedge#1#2{\ncdiagg[nodesep=3pt,angleA=180,armA=0]{#2}{#1}}
\pstree[treemode=R,levelsep=*0.2cm,treesep=0.5cm]{\Tr{App::Math::Tutor}}{%
    \pstree[levelsep=*0.2cm]
        {\Tr{App::Math::Tutor::Cmd::VulFrac}}
        {\Tr{App::Math::Tutor::Cmd::VulFrac::Cmd::Add} \Tr{App::Math::Tutor::Cmd::VulFrac::Cmd::Mul} \Tr{App::Math::Tutor::Cmd::VulFrac::Cmd::Cast}}
    \pstree[levelsep=*0.2cm]
        {\Tr{App::Math::Tutor::Cmd::Natural}}
        {\Tr{App::Math::Tutor::Cmd::Natural::Cmd::Add} \Tr{App::Math::Tutor::Cmd::Natural::Cmd::Mul}}
    \pstree[levelsep=*0.2cm]
        {\Tr{App::Math::Tutor::Cmd::Roman}}
        {\Tr{App::Math::Tutor::Cmd::Roman::Cmd::Add} \Tr{App::Math::Tutor::Cmd::Roman::Cmd::Cast}}
    \pstree[levelsep=*0.2cm]
        {\Tr{App::Math::Tutor::Cmd::Unit}}
        {\Tr{App::Math::Tutor::Cmd::Unit::Cmd::Add} \Tr{App::Math::Tutor::Cmd::Unit::Cmd::Mul} \Tr{App::Math::Tutor::Cmd::Unit::Cmd::Cast}}
}

\end{block}

\end{frame}

\subsection{CLI Concept}

\begin{frame}[t,fragile]

\begin{block}<1->{Exercise Groups}
\begin{description}
\item[App::Math::Tutor::Cmd::VulFrac] Exercises in vulgar fraction calculation
\item[App::Math::Tutor::Cmd::Natural] Exercises in calculations using natural numbers
\item[App::Math::Tutor::Cmd::Roman] Exercises in calculations using natural numbers, but show them using roman number encoding (exercises and solutions)
\item[App::Math::Tutor::Cmd::Unit] Exercises in calculations using units (times, currency, \ldots)
\item[App::Math::Tutor::Cmd::Power] Exercises in calculations of power mathematics
\item[App::Math::Tutor::Cmd::Polynom] Exercises for polynomial mathematics (Zero of a function, Vertex, \ldots)
\end{description}
\end{block}

\end{frame}

\section{Design}

\subsection{Simple Exercise}

\begin{frame}[t,fragile]

\begin{block}<1->{Typical Exercise design}
\begin{pspicture}(12,7)%\psgrid
\scriptsize
 \rput(8.5,6.25){\rnode{A}{%
  \umlClass{App::Math::Tutor::Cmd::VulFrac::Cmd::Add}{\hline
 \_build\_exercise() : exercise
 }}}
 \uncover<3->{\rput(8.5,4.5){\rnode{B}{%
  \umlClass{App::Math::Tutor::Role::VulfracExercise}{
  format\\\hline
  \\\hline
 }}}}
 \uncover<4->{\rput(3,1){\rnode{C}{%
  \umlClass{App::Math::Tutor::Role::Vulfrac}{\hline
 \_check\_vulgar\_fraction() : bool \\
 \_guess\_vulgar\_fraction() : VulFrac \\
 get\_vulgar\_fractions() : [ VulFrac ]
 }}}}
 \uncover<2->{\rput(2.5,5){\rnode{D}{%
  \umlClass{VulFrac}{
  num\\
  denum\\
  \hline
  \_stringify() : Str \\
  \_numify() : Num \\
  \_num\_compare() : Int \\
  \_euklid() : Int \\
  \_gcd() : Int \\
  \_reduce() : VulFrac \\
  \_reciprocal() : VulFrac \\
 }}}}
 \uncover<5->{\rput(9,1.5){\rnode{E}{%
  \umlClass{App::Math::Tutor::Role::Exercise}{
  exercise : lazy \\
  \# \{ section, caption, label, \\
  \#    header, challenges, solutions \}\\
  output\_name : lazy\\
  template\_filename : lazy\\
  \hline
  \_build\_exercise() = 0 : exercise\\
  \_build\_output\_name() : Str\\
  \_build\_template\_filename() = 0 : Str\\
  execute()
 }}}}
\end{pspicture}
\uncover<3->{\ncN{B}{A} % App::Math::Tutor::Cmd::VulFrac::Cmd::Add -> App::Math::Tutor::Role::VulfracExercise
\ncputicon[npos=0]{umlHerit}}
\uncover<4->{\ncNXE{C}{B} % App::Math::Tutor::Role::VulfracExercise -> App::Math::Tutor::Role::Vulfrac
\ncputicon[npos=0]{umlHerit}}
\uncover<5->{\ncNXW{E}{B} % App::Math::Tutor::Role::VulfracExercise -> App::Math::Tutor::Role::Exercise
\ncputicon[npos=0]{umlHerit}}
\uncover<3->{\ncSXE{D}{B}
\ncputicon[npos=0]{umlAgreg}}
\uncover<2->{\ncline[linestyle=dashed]{D}{A}}
\end{block}

\end{frame}

\subsection{Derived Exercise}

\begin{frame}[t,fragile]

\begin{block}<1->{Derived Exercise design}
\resizebox{\textwidth}{!}{
\begin{pspicture}(16,10)%\psgrid
\scriptsize
 \rput(13,9){\rnode{A}{%
  \umlClass{App::Math::Tutor::Cmd::Roman::Cmd::Add}{\hline
 \_build\_exercise() : exercise
 }}}
 \rput(13,6){\rnode{B}{%
  \umlClass{App::Math::Tutor::Role::NaturalExercise}{
  format\\\hline
  \\\hline
 }}}
 \uncover<3->{\rput(4,3.5){\rnode{C}{%
  \umlClass{App::Math::Tutor::Role::Roman}{\hline
 around => \_guess\_natural\_number() : Roman \\
 }}}}
 \rput(4,1){\rnode{D}{%
  \umlClass{App::Math::Tutor::Role::Natural}{\hline
 \_check\_natural\_number() : bool \\
 \_guess\_natural\_number() : Natural \\
 get\_natural\_number() : [ Natural ]
 }}}
 \uncover<2->{\rput(4,9){\rnode{E}{%
  \umlClass{RomanNum}{
  \hline
  \_stringify() : Str \\
 }}}}
 \rput(4,6){\rnode{F}{%
  \umlClass{Natural}{
  value\\
  \hline
  \_stringify() : Str \\
  \_numify() : Num \\
  \_num\_compare() : Int \\
 }}}
 \rput(13,2){\rnode{G}{%
  \umlClass{App::Math::Tutor::Role::Exercise}{
  exercise : lazy \\
  \# \{ section, caption, label, \\
  \#    header, challenges, solutions \}\\
  output\_name : lazy\\
  template\_filename : lazy\\
  \hline
  \_build\_exercise() = 0 : exercise\\
  \_build\_output\_name() : Str\\
  \_build\_template\_filename() = 0 : Str\\
  execute()
 }}}
\end{pspicture}
\ncN{B}{A} % App::Math::Tutor::Cmd::Roman::Cmd::Add -> App::Math::Tutor::Role::NaturalExercise
\ncputicon[npos=0]{umlHerit}
\ncEXN{D}{B} % App::Math::Tutor::Role::NaturalExercise -> App::Math::Tutor::Role::Natural
\ncputicon[npos=0]{umlHerit}
\ncN{G}{B} % App::Math::Tutor::Role::NaturalExercise -> App::Math::Tutor::Role::Exercise
\ncputicon[npos=0]{umlHerit}
\ncE{F}{B}
\ncputicon[npos=0]{umlAgreg}
\uncover<2->{\ncline[linestyle=dashed,linecolor=blue]{E}{A}}
\uncover<3->{\ncN[linecolor=blue]{D}{C} % App::Math::Tutor::Role::Roman -> App::Math::Tutor::Role::Natural
\ncputicon[npos=0,linecolor=blue]{umlHerit}}
\uncover<3->{\ncEVE[linecolor=blue]{C}{A} % App::Math::Tutor::Cmd::Roman::Cmd::Add -> App::Math::Tutor::Role::Roman
\ncputicon[npos=0,linecolor=blue]{umlHerit}}
\uncover<2->{\ncN[linecolor=blue]{F}{E} % RomanNum -> Natural
\ncputicon[npos=0,linecolor=blue]{umlHerit}}
} % end of resizebox
\end{block}

\end{frame}

\section{Improvements}

\subsection{Design}

\begin{frame}[t,fragile]

\begin{block}<1->{Improving design}
\begin{itemize}
\item introduce factories
\uncover<2->{\item add lazy factory attribute \uncover<3->{(allowes overriding factory to use by \texttt{around}'ing builder)}}
\uncover<4->{\item separate \texttt{number} classes (type system, but \textbf{no} \texttt{MooseX::Types})}
\uncover<5->{\item approval for reasonable exercise value should be part of factory}
\uncover<6->{\item approval for valid number should be \texttt{coerce}d (\texttt{trigger}?)}
\end{itemize}
\end{block}

\begin{block}<7->{Design history}
\begin{itemize}
\item I started with just vulgar fraction exercises
\uncover<8->{\item Design covered exactly those needs}
\end{itemize}
\end{block}

\begin{block}<9->{Design futury}
\begin{itemize}
\item Modern Perl-OO allowes easy refactoring to apply above improvements
\end{itemize}
\end{block}

\end{frame}

\part{Moo eXtensions}

\section{MooX}

\subsection{General purpose eXtensions}

\begin{frame}[t,fragile]{MooX in general}

Some Moo extensions for getting a picture - the list is neither complete nor is it intended to be

\begin{block}<1->{MooX Distributions}
\begin{description}
\item[MooX::Log::Any] logging role building a very lightweight wrapper to Log::Any
\uncover<2->{\item[MooX::Validate] minimalist Data Validation for Moo}
\uncover<3->{\item[MooX::Types::MooseLike] Moose like types for Moo}
\uncover<4->{\item[MooX::Override] adds ''override method =\textgreater{} sub {\ldots}'' support to Moo}
\uncover<5->{\item[MooX::Augment] adds ''augment method =\textgreater{} sub {\ldots}'' support to Moo}
\uncover<6->{\item[MooX::late] easily translate Moose code to Moo}
\uncover<7->{\item[MooX::PrivateAttributes] create attribute only usable inside your package}
\uncover<8->{\item[MooX::Singleton] turn your Moo class into singleton}
\uncover<9->{\item[MooX::Aliases] easy aliasing of methods and attributes in Moo}
\end{description}
\end{block}

\end{frame}

\subsection{CLI related eXtensions}

\begin{frame}[t,fragile]{MooX Distributions for CLI}

\begin{block}<1->{MooX::Cmd}
\begin{itemize}
\item giving an easy Moo style way to make command organized CLI apps
\item support sub-commands with separated options when used together with MooX::Options
\end{itemize}
\end{block}

\begin{block}<2->{MooX::Options}
\begin{itemize}
\item explicit Options eXtension for Object Class
\item no mess with composed attributes
\end{itemize}
\end{block}

\begin{block}<3->{MooX::ConfigFromFile}
\begin{itemize}
\item Moo eXtension for initializing objects from config file
\item RC files with structures (JSON, INI, YAML, XML, ...)
\end{itemize}
\end{block}

\end{frame}

\begin{frame}[t,fragile]{General CLI Construction Flow}

\resizebox{\textwidth}{!}{
\begin{pspicture}(25,18)%\psgrid
     % 
     \rput(2,17.5){\rnode{main}{\umlClass{\underline{:main}}{}}}
     \uncover<2->{\rput(6,17.5){\rnode{Cmd}{\umlClass{\underline{:MooX::Cmd}}{}}}}
     \uncover<4->{\rput(11,17.5){\rnode{Options}{\umlClass{\underline{:MooX::Options}}{}}}}
     \uncover<7->{\rput(16,17.5){\rnode{CFF}{\umlClass{\underline{:MooX::ConfigFromFile}}{}}}}
     \uncover<6->{\rput(22,17.5){\rnode{Core}{\umlClass{\underline{:Moo}}{}}}}

     %\\[+0.3cm] % 2: new_with_cmd()
     %{} & {} & {} & {} & {} \\[-0.6cm]
     %{} & {\rnode{bcc}{}\psframebox{\parbox[c][0.2cm][c]{0.8cm}{ }}} & {} & {} & {} \\[-0.8cm] % 4: load cmds / build cmd name hash
     %{} & {\rnode{bccE}{}} & {} & {} & {} \\[-0.6cm]
     %{} & {} & {} & {} & {} \\[-0.2cm] % 6: separate arguments
     %{} & {} & {} & {} & {} \\[-0.6cm]
     %{} & {} & {} & {} & {} \\[-0.2cm] % 8: new_with_options
     %{} & {} & {} & {} & {} \\[-0.6cm]
     %{} & {} & {} & {} & {} \\[-0.2cm] % 10: parse @ARGV
     %{} & {} & {} & {} & {} \\[-0.6cm]
     %{} & {} & {} & {} & {} \\[-0.2cm] % 12: new
     %{} & {} & {} & {} & {} \\[-0.6cm]
     %{} & {} & {} & {} & {} \\[-0.2cm] % 14: Moo::BUILDARGS
     %{} & {} & {} & {} & {} \\[-0.6cm]
     %{} & {} & {} & {} & {} \\[-0.2cm] % 16: CFF::BUILDARGS
     %{} & {} & {} & {} & {} \\[-0.6cm]
     %{} & {} & {} & {} & {} \\[-0.2cm] % 18: _build_loaded_config
     %{} & {} & {} & {} & {} \\[-0.6cm]
     %{} & {} & {} & {} & {} \\[-0.2cm] % 20: catch "attribute missing" {}
     %{} & {} & {} & {} & {} \\[-0.6cm]
     %{} & {} & {} & {} & {} \\[-0.2cm] % 22: execute
     %{} & {} & {} & {} & {} \\[-0.6cm]
     %% 
     %{} & {} \\[0cm] % 24 ([0cm] necessary : bug ?)
     %
     \rput(2,1){\rnode{mainEnd}{ }}
     \uncover<2->{\rput(6,1){\rnode{CmdEnd}{}}}
     \uncover<4->{\rput(11,1){\rnode{OptionsEnd}{}}}
     \uncover<7->{\rput(16,1){\rnode{CFFEnd}{}}}
     \uncover<6->{\rput(22,1){\rnode{CoreEnd}{}}}
     \ncline[linestyle=dashed]{main}{mainEnd}
     \uncover<2->{\ncline[linestyle=dashed]{Cmd}{CmdEnd}}
     \uncover<4->{\ncline[linestyle=dashed]{Options}{OptionsEnd}}
     \uncover<7->{\ncline[linestyle=dashed]{CFF}{CFFEnd}}
     \uncover<6->{\ncline[linestyle=dashed]{Core}{CoreEnd}}

     \psframe[linewidth=0.5pt,linestyle=solid,fillstyle=solid,fillcolor=white](1.8,16.5)(2.2,1.5)
     \uncover<2->{
     \psframe[linewidth=0.5pt,linestyle=solid,fillstyle=solid,fillcolor=white](5.8,16.5)(6.2,1.5)
     \rput(2.2,16.5){\rnode{main2nwc}{}}
     \rput(5.8,16.5){\rnode{nwcS}{}} % new_with_cmd_Start
     \rput(5.8,1.5){\rnode{nwcE}{}} % new_with_cmd_End
     \rput(2.2,1.5){\rnode{mainC}{}} % main Continue / exit
     \ncline[linewidth=0.5pt,linestyle=solid]{->}{main2nwc}{nwcS}\naput*[Ynodesep=0.5]{\small new\_with\_cmd()}}

     \uncover<3->{
     \rput(6.2,16.25){\rnode{bccS}{}}
     \rput(6.2,14.75){\rnode{bccE}{}}
     \ncEVW[linewidth=0.5pt,linestyle=solid]{bccE}{bccS}
     \ncputicon[npos=0]{umlV}
     \nbput*[nrot=:U,npos=1.25]{\small \shortstack{\_build\_command\\\_commands()}}}

     \uncover<3->{
     \rput(6.2,14.25){\rnode{savS}{}}
     \rput(6.2,12.75){\rnode{savE}{}}
     \ncEVW[linewidth=0.5pt,linestyle=solid]{savE}{savS}
     \ncputicon[npos=0]{umlV}
     \nbput*[nrot=:U,npos=1.25]{\small \_split\_argv}}

     \uncover<4->{
     \psframe[linewidth=0.5pt,linestyle=solid,fillstyle=solid,fillcolor=white](10.8,12.5)(11.2,3.5)
     \rput(6.2,12.5){\rnode{nwc2cc}{}} % new_with_cmd -> _chained_constructor
     \rput(10.8,12.5){\rnode{nwoS}{}} % new_with_options_Start
     \rput(10.8,3.5){\rnode{nwoE}{}} % new_with_options_End
     \rput(6.2,3.5){\rnode{nwcC}{}} % new_with_cmd Continue
     \ncline[linewidth=0.5pt,linestyle=solid]{->}{nwc2cc}{nwoS}\naput*[Ynodesep=0.5]{\small new\_with\_options()}}

     \uncover<5->{
     \rput(11.2,12.25){\rnode{poS}{}}
     \rput(11.2,10.75){\rnode{poE}{}}
     \ncEVW[linewidth=0.5pt,linestyle=solid]{poE}{poS}
     \ncputicon[npos=0]{umlV}
     \nbput*[nrot=:U,npos=1.25]{\small \shortstack{\_parse\\\_options}}}

     \uncover<6->{
     \uncover<8->{
     \psframe[linewidth=0.5pt,linestyle=solid,fillstyle=solid,fillcolor=white](21.6,9)(22,8.25)}
     \psframe[linewidth=0.5pt,linestyle=solid,fillstyle=solid,fillcolor=white](21.8,10.5)(22.2,5.5)
     \rput(11.2,10.5){\rnode{nwo2new}{}} % new_with_options -> new
     \rput(21.8,10.5){\rnode{newS}{}} % new_Start
     \rput(21.8,5.5){\rnode{newE}{}} % new_End
     \rput(11.2,5.5){\rnode{nwoC}{}} % new_with_options Continue
     \ncline[linewidth=0.5pt,linestyle=solid]{->}{nwo2new}{newS}\naput*[Ynodesep=0.5]{\small new()}}

     \uncover<7->{
     \psframe[linewidth=0.5pt,linestyle=solid,fillstyle=solid,fillcolor=white](15.8,9.5)(16.2,6)
     \rput(21.8,9.5){\rnode{new2blda}{}} % new -> BUILDARGS
     \rput(16.2,9.5){\rnode{aBS}{}} % around BUILDARGS => Start
     \rput(16.2,6){\rnode{aBE}{}} % around BUILDARGS => End
     \rput(21.8,6){\rnode{newC}{}} % new Continue
     \ncline[linewidth=0.5pt,linestyle=solid]{->}{new2blda}{aBS}\nbput*[Ynodesep=0.5]{\small BUILDARGS()}}

     \uncover<8->{
     \rput(16.2,8.75){\rnode{baC}{}} % BUILDARGS Call
     \rput(21.6,8.75){\rnode{baS}{}} % BUILDARGS Start
     \ncline[linewidth=0.5pt,linestyle=solid]{->}{baC}{baS}\naput*[Ynodesep=0.5]{\small super-\textgreater{}BUILDARGS()}
     \rput(21.6,8.5){\rnode{baE}{}} % BUILDARGS Start
     \rput(16.2,8.5){\rnode{aBC}{}} % around BUILDARGS => Continue
     \ncline[linewidth=0.5pt,linestyle=solid]{->}{baE}{aBC}}

     \uncover<9->{
     \rput(16.2,8){\rnode{blcS}{}} % _build_loaded_config Start
     \rput(16.2,6.5){\rnode{blcE}{}} % _build_loaded_config End
     \ncEVW[linewidth=0.5pt,linestyle=solid]{blcE}{blcS}
     \ncputicon[npos=0]{umlV}
     \nbput*[nrot=:U,npos=1.25]{\small \shortstack{\_build\_loaded\\\_config}}
     \ncline[linewidth=0.5pt,linestyle=solid]{->}{aBE}{newC}} % around BUILDARGS => End -> new Continue
     \uncover<10->{
     \ncline[linewidth=0.5pt,linestyle=solid]{->}{newE}{nwoC}} % new End -> new_with_options Continue

     \uncover<11->{
     \rput(11.2,5.25){\rnode{hoeS}{}}
     \rput(11.2,3.75){\rnode{hoeE}{}}
     \ncEVW[linewidth=0.5pt,linestyle=solid]{hoeE}{hoeS}
     \ncputicon[npos=0]{umlV}
     \nbput*[nrot=:U,npos=1.25]{\small \shortstack{help on\\exception}}

     \ncline[linewidth=0.5pt,linestyle=solid]{->}{nwoE}{nwcC}} % new_with_options_End -> new_with_cmd Continue

     \uncover<12->{
     \rput(6.2,3.25){\rnode{eS}{}} % execute Start
     \rput(6.2,1.75){\rnode{eE}{}} % execute End
     \ncEVW[linewidth=0.5pt,linestyle=solid]{eE}{eS}
     \ncputicon[npos=0]{umlV}
     \nbput*[nrot=:U,npos=1.25]{\small execute}}

     \uncover<2->{\ncline[linewidth=0.5pt,linestyle=solid]{->}{nwcE}{mainC}}
     %
     %
     %\small\ttfamily% Functions
     %\psset{labelsep=1.5mm}
     %\ncbox*[linecolor=lightgray]{->}{2,2}{3,2}
     %\ncline[linewidth=0.5pt,linestyle=solid]{->}{2,1}{2,2}\naput*[Ynodesep=0.5]{\small new\_with\_cmd()}
     %\ncbar[linewidth=0.5pt,linestyle=solid,linecolor=red,angle=90,arrows=->]{bcc}{bccE}%\naput*[Ynodesep=0.25]{\_build\_command\_commands()}
     %\ncline[linewidth=0.5pt,linestyle=solid]{->}{5,2}{5,1}%\naput*{}
     %\ncline[linewidth=0.5pt,linestyle=solid]{->}{6,1}{6,2}\naput*[Ynodesep=0.75]{identifyDaemon()}
     %\ncline[linewidth=0.5pt,linestyle=solid]{->}{7,2}{7,1}%\naput*{}
     %\ncline[linewidth=0.5pt,linestyle=solid]{->}{8,1}{8,2}\naput*{fetchData()}
     %\ncline[linewidth=0.5pt,linestyle=solid]{->}{9,2}{9,1}%\naput*{}
     %\ncline[linewidth=0.5pt,linestyle=solid]{->}{10,1}{10,2}\naput*{convert()}
     %\ncline[linewidth=0.5pt,linestyle=solid]{->}{11,2}{11,1}%\naput*{}
     %\ncline[linewidth=0.5pt,linestyle=solid]{->}{12,1}{12,2}\naput*{createMessages()}
     %\ncline[linewidth=0.5pt,linestyle=solid]{->}{13,2}{13,1}%\naput*{}
     %\ncline[linewidth=0.5pt,linestyle=solid]{->}{14,1}{14,2}\naput*{prove()}
     %\ncline[linewidth=0.5pt,linestyle=solid]{->}{15,2}{15,1}%\naput*{}
     %\ncline[linewidth=0.5pt,linestyle=solid]{->}{16,1}{16,2}\naput*{report()}
     %\ncline[linewidth=0.5pt,linestyle=solid]{->}{17,2}{17,1}%\naput*{}
     %\ncline[linewidth=0.5pt,linestyle=solid]{->}{23,2}{23,1}%\nbput*{}
     %
     % 
\end{pspicture}
}%end resizebox

\end{frame}

\part{Current Practice}

\section{Provided Framework}

\subsection{Exercise Role}

\begin{frame}[t,fragile]

\begin{block}<1->{}
\scriptsize
\begin{lstlisting}[language=Perl,inputencoding=latin9,escapeinside={(*@}{@*)}]
package App::Math::Tutor::Role::Exercise;

use strictures; # instead of strict + warnings
use Moo::Role(*@\pnode(0,0){A}{}@*); use MooX::Options(*@\pnode(0,0){B}{}@*);

option (*@\pnode(0,0){C}{}@*)amount => (
                   is       => "ro",
                   doc      => "Specifies amount of exercises to generate",
                   (*@\pnode(0,0){D}{}@*)long_doc => "Specify amount of exercises to generate. "
                     . "In case of several kind of ...",
                   format  => "i",
                   short   => "n",
                   default => sub { 15 },
                 );

has output(*@\pnode(0,0){E}{}@*)_name => ( is => "lazy(*@\pnode(0,0){F}{}@*)" );
sub (*@\pnode(0,0){G}{}@*)_build_output_name {
    join( "", map { $_->command_name || "" } @{ $_[0]->command_chain } );
}
\end{lstlisting}
\end{block}

\begin{itemize}
\uncover<2->{\item being a \rnode{a}{role} (no \textit{is a} relationship) \uncover<3->{and add \rnode{b}{CLI options} capabilities}}
\uncover<4->{\item defining an \rnode{c}{attribute} which will be initialized by command line}
\uncover<5->{\item support MooX::Option's \rnode{d}{\texttt{--man}} usage feature}
\uncover<6->{\item attribute for \rnode{e}{output file} to generate \uncover<7->{--- \rnode{f}{lazy} to allow provide individual \rnode{g}{name builder}}}
\end{itemize}
\uncover<2-3>{\nccurve[linecolor=olive]{->}{a}{A}}
\uncover<3>{\nccurve[linecolor=olive]{->}{b}{B}}
\uncover<4-5>{\nccurve[linecolor=olive]{->}{c}{C}}
\uncover<5>{\nccurve[linecolor=olive]{->}{d}{D}}
\uncover<6-8>{\nccurve[linecolor=teal]{->}{e}{E}}
\uncover<7-8>{\nccurve[linecolor=cyan]{->}{f}{F}}
\uncover<8>{\nccurve[linecolor=cyan]{->}{g}{G}}

\end{frame}

\begin{frame}[t,fragile]

\begin{block}<1->{}
\scriptsize
\begin{lstlisting}[language=Perl,inputencoding=latin9,escapeinside={(*@}{@*)}]
has (*@\pnode(0,0){A}{}@*)exercises => ( is => "lazy(*@\pnode(0,0){B}{}@*)" );
sub (*@\pnode(0,0){C}{}@*)execute {
    my $exercises = $_[0]-(*@\pnode(0,0){D}{}@*)>exercises;
    my $ttcpath = (*@\pnode(0,0){E}{}@*)File::Spec->catfile(
        File::ShareDir::dist_dir("App-Math-Tutor")(*@\pnode(0,0){F}{}@*),
        $_[0]->(*@\pnode(0,0){G}{}@*)template_filename . ".tt2" );
    my $template = Template(*@\pnode(0,0){H}{}@*)->new( { ABSOLUTE => 1 });
    my $rc = $template->(*@\pnode(0,0){I}{}@*)process( $ttcpath, {
                                    exercises => $exercises,
                                    output    => { format(*@\pnode(0,0){J}{}@*) => 'pdf' },
                                 },
                                 $_[0]->output_name . '.pdf');
    $rc or croak( $template->error() );
    return 0;
}
\end{lstlisting}
\end{block}

\begin{itemize}
\uncover<2->{\item attribute containing the \rnode{a}{exercises} definitions, exercises itself and their solutions
             (depending on template)\uncover<3->{ --- lazy \rnode{b}{implies} \texttt{requires ''\_build\_exercises''}}}
\uncover<4->{\item \rnode{c}{method} to satisfy \texttt{MooX::Cmd}}
\uncover<5->{\item \rnode{d}{fetch} exercises definition \uncover<6->{implies calling \texttt{\_build\_exercises}}}
\uncover<7->{\item build \rnode{e}{full qualified path} of \rnode{g}{template} file name residing in app's \rnode{f}{\texttt{share}} directory,
             \uncover<10->{instantiate template \rnode{h}{processor} \uncover<11->{and \rnode{i}{run} it}}}
\uncover<12->{\item force output \rnode{j}{format} ''pdf'' (\texttt{Template::LaTeX} will be instructed by template)}
\end{itemize}
\uncover<2-3>{\nccurve[linecolor=teal]{->}{a}{A}}
\uncover<3>{\nccurve[linecolor=red]{->}{b}{B}}
\uncover<4>{\nccurve[linecolor=blue]{->}{c}{C}}% blau macht glücklich :P /wave Getty
\uncover<5-6>{\nccurve[linecolor=RedViolet]{->}{d}{D}}
\uncover<7-9>{\nccurve[linecolor=teal]{->}{e}{E}}
\uncover<8-9>{\nccurve[linecolor=teal]{->}{f}{F}}
\uncover<9>{\nccurve[linecolor=cyan]{->}{g}{G}}
\uncover<10-11>{\nccurve[linecolor=teal]{->}{h}{H}}
\uncover<11>{\nccurve[linecolor=teal]{->}{i}{I}}
\uncover<12>{\nccurve[linecolor=olive]{->}{j}{J}}

\end{frame}

\subsection{Vulgar Fraction Exercise Role}

\begin{frame}[t,fragile]

\begin{block}<1->{}
\scriptsize
\begin{lstlisting}[language=Perl,inputencoding=latin9,escapeinside={(*@}{@*)}]
package App::Math::Tutor::Role::Vul(*@\pnode(0,0){E0}{}@*)FracExercise(*@\pnode(0,0){D0}{}@*);
use (*@\pnode(0,0){A}{}@*)strictures; use (*@\pnode(0,0){B}{}@*)Moo::Role; use (*@\pnode(0,0){C}{}@*)MooX::Options;
with (*@\pnode(0,0){D}{}@*)"App::Math::Tutor::Role::Exercise", (*@\pnode(0,0){E}{}@*)"App::Math::Tutor::Role::VulFrac";

option (*@\pnode(0,0){F}{}@*)format => (
    is       => "ro",
    doc      => "specifies format of numerator/denominator",
    long_doc => "Allow specifying the format of the numerator/denominator ...",
    (*@\pnode(0,0){G}{}@*)isa => sub { defined( $_[0] ) and !ref $_[0]
          and $_[0] !~ m,^\d?n+(?:/\d?n+)?$, and die("Invalid format");
    },
    (*@\pnode(0,0){H}{}@*)coerce => sub { ...
        my ( $fmta, $fmtb ) = ( $_[0] =~ m,^(\d?n+)(?:/(\d?n+))?$, );
        $fmtb //= $fmta;
        my $starta = "1"; my $startb = "1";
        $fmta =~ s/^(\d)(.*)/$2/ and $starta = $1;
        $fmtb =~ s/^(\d)(.*)/$2/ and $startb = $1;
        [ $starta . "0" x length($fmta), $startb . "0" x length($fmtb) ]
    },
    default => sub { return [ 100, 100 ]; }, format  => "s",
                 );
\end{lstlisting}
\end{block}

\begin{itemize}
\uncover<2->{\item be \rnode{a}{a nice} package \uncover<3->{\rnode{b}{\textasciicircum{}Wrole}, \uncover<4->{intending to provide command line options for instantiation}}}
\uncover<5->{\item compose role behavior using \rnode{d}{Exercise} and \rnode{e}{VulFrac}}
\uncover<7->{\item define \rnode{f}{option} \uncover<8->{\rnode{h}{coercing} option string into array \uncover<9->{\rnode{g}{ensuring} the array ref as value}}}
\end{itemize}
\uncover<2-4>{\nccurve[linecolor=blue]{->}{a}{A}}
\uncover<3-4>{\nccurve[linecolor=RedViolet]{->}{b}{B}}
\uncover<4>{\nccurve[linecolor=teal]{->}{c}{C}}
\uncover<5>{\nccurve[linecolor=blue]{->}{d}{D}}
\uncover<5>{\nccurve[linecolor=RedViolet]{->}{d}{D0}}
\uncover<6>{\nccurve[linecolor=blue]{->}{e}{E}}
\uncover<6>{\nccurve[linecolor=RedViolet]{->}{e}{E0}}
\uncover<7-9>{\nccurve[linecolor=olive]{->}{f}{F}}
\uncover<8-9>{\nccurve[linecolor=blue]{->}{h}{H}}
\uncover<9>{\nccurve[linecolor=RedViolet]{->}{g}{G}}
\end{frame}

\section{Create Exercise}

\subsection{Preamble}

\begin{frame}[t,fragile]

\begin{block}<1->{}
\scriptsize
\begin{lstlisting}[language=Perl,inputencoding=latin9,escapeinside={(*@}{@*)}]
package App::Math::(*@\pnode(0,0){A}{}@*)Tutor::Cmd::(*@\pnode(0,0){B}{}@*)VulFrac::Cmd::(*@\pnode(0,0){C}{}@*)Add;

use strictures;

use Moo;
use MooX::Cmd;
use MooX::Options;

has (*@\pnode(0,0){D}{}@*)template_filename => ( is      => "ro",
                           default => "twocols"(*@\pnode(0,0){E}{}@*));

(*@\pnode(0,0){F}{}@*)with "App::Math::Tutor::Role::VulFracExercise(*@\pnode(0,0){G}{}@*)";
\end{lstlisting}
\end{block}

\begin{itemize}
\uncover<2->{\item \texttt{\$ \rnode{a}{mtut} \uncover<3->{\rnode{b}{vulfrac} \uncover<4->{\rnode{c}{add}}}}}
\uncover<5->{\item we're of course a nice class}
\uncover<6->{\item satisfy requirement of Exercise role: provide \rnode{d}{template\_filename} \uncover<7->{-- \rnode{e}{two column} template (for addition and substraction)}}
\uncover<8->{\item \rnode{f}{compose} role \texttt{\ldots{}\rnode{g}{VulFracExercise}}}
\end{itemize}
\uncover<2-4>{\nccurve[linecolor=cyan]{->}{a}{A}}
\uncover<3-4>{\nccurve[linecolor=cyan]{->}{b}{B}}
\uncover<4>{\nccurve[linecolor=cyan]{->}{c}{C}}
\uncover<6-7>{\nccurve[linecolor=blue]{->}{d}{D}}
\uncover<7>{\nccurve[linecolor=blue]{->}{e}{E}}
\uncover<8>{\nccurve[linecolor=teal]{->}{f}{F}}
\uncover<8>{\nccurve[linecolor=teal]{->}{g}{G}}
\end{frame}

\subsection{Create Exercise Numbers}

\begin{frame}[t,fragile]

\begin{block}<1->{}
\scriptsize
\begin{lstlisting}[language=Perl,inputencoding=latin9,escapeinside={(*@}{@*)}]
sub (*@\pnode(0,0){A}{}@*)_build_exercises {
    my ($self) = @_;

    my ((*@\pnode(0,0){B}{}@*)@tasks);
    foreach my $i ( 1 .. $self->(*@\pnode(0,0){C}{}@*)amount ) {
        my @line(*@\pnode(0,0){F0}{}@*);
        for ( (*@\pnode(0,0){D}{}@*)0 .. 1 ) { # 0: +, 1: -
            my ( $a, $b ) = $self->(*@\pnode(0,0){E}{}@*)get_vulgar_fractions(2);
            push @line, [ $a, $b ];
        }
        push(*@\pnode(0,0){F}{}@*) @tasks, \@line;
    }

    my $exercises = ...;
    return $exercises;
}
\end{lstlisting}
\end{block}

\begin{itemize}
\uncover<2->{\item \rnode{a}{exercise builder} has to be provided by individual exercise}
\uncover<3->{\item hold \rnode{b}{tasks} of the exercise sheet}
\uncover<4->{\item \rnode{c}{how many} tasks per sheet? \uncover<5->{(remember the option in \texttt{\ldots{}Role::Exercise})}}
\uncover<6->{\item \rnode{d}{a ''+'' and a ''-''} exercise per line}
\uncover<7->{\item invoke \rnode{e}{factory} per task}
\uncover<8->{\item \rnode{f}{safe} each \rnode{f0}{line} for processing}
\end{itemize}
\uncover<2>{\nccurve[linecolor=teal]{->}{a}{A}}
\uncover<3>{\nccurve[linecolor=olive]{->}{b}{B}}
\uncover<4>{\nccurve[linecolor=olive]{->}{c}{C}}
\uncover<6>{\nccurve[linecolor=cyan]{->}{d}{D}}
\uncover<7>{\nccurve[linecolor=cyan]{->}{e}{E}}
\uncover<8>{\nccurve[linecolor=olive]{->}{f}{F}}
\uncover<8>{\nccurve[linecolor=olive]{->}{f0}{F0}}

\end{frame}

\subsection{Format Challenge / Solution}

\begin{frame}[t,fragile]

\begin{block}<1->{}
\scriptsize
\begin{lstlisting}[language=Perl,inputencoding=latin9,escapeinside={(*@}{@*)}]
my (*@\pnode(0,0){A}{}@*)$exercises = {
                  section => "Vulgar fraction addition / subtraction",
                  caption => 'Fractions',
                  label   => 'vulgar_fractions_addition',
                  header  => [ [ 'Vulgar Fraction Addition', 'Vulgar Fraction Subtraction' ] ],
                  (*@\pnode(0,0){B}{}@*)challenges => [], (*@\pnode(0,0){C}{}@*)solutions  => [],
                };

foreach(*@\pnode(0,0){D}{}@*) my $line (@tasks) {
    my ( @solution, @challenge );
    foreach(*@\pnode(0,0){E}{}@*) my $i ( 0 .. 1 ) {
        my ( $a, $b, @way ) = @{ $line->[$i] }; my $op = $i ? '-' : '+';
        $op eq '-' and $a < $b and (*@\pnode(0,0){F}{}@*)( $b, $a ) = ( $a, $b );
        push (*@\pnode(0,0){G}{}@*)@challenge, sprintf( '$ (*@\pnode(0,0){H}{}@*)%s %s (*@\pnode(0,0){I}{}@*)%s = $', (*@\pnode(0,0){J}{}@*)$a, $op, (*@\pnode(0,0){K}{}@*)$b );
        push (*@\pnode(0,0){M}{}@*)@way, sprintf( '(*@\pnode(0,0){L}{}@*)%s %s %s', $a, $op, $b );
        ...
    }
    push( @{ $exercises->{(*@\pnode(0,0){N}{}@*)challenges} }, \@challenge );
    push( @{ $exercises->{solutions(*@\pnode(0,0){O}{}@*)} },  \@solution );
}
\end{lstlisting}
\end{block}

\begin{itemize}
\uncover<2->{\item \rnode{a}{create} exercise structure containing \uncover<3->{\rnode{b}{challenges} and \rnode{c}{solutions}}}
\uncover<5->{\item \rnode{d}{loop} over created tasks \uncover<6->{and exercises \rnode{e}{per line}}}
\uncover<7->{\item format \rnode{g}{challenge} using \rnode{h}{\texttt{operator '""'}} of \rnode{j}{\texttt{VulFrac}} objects}
\uncover<10->{\item \rnode{l}{same} (but \rnode{m}{different}) opening ''way'' \uncover<12->{and \rnode{n}{remember} the little thingies \ldots}}
\end{itemize}
\uncover<2-4>{\nccurve[linecolor=teal]{->}{a}{A}}
\uncover<3-4>{\nccurve[linecolor=olive]{->}{b}{B}}
\uncover<4>{\nccurve[linecolor=olive]{->}{c}{C}}
\uncover<5-6>{\nccurve[linecolor=cyan]{->}{d}{D}}
\uncover<6>{\nccurve[linecolor=cyan]{->}{e}{E}}
\uncover<7-9>{\nccurve[linecolor=teal]{->}{g}{G}}
\uncover<8-9>{\nccurve[linecolor=cyan]{->}{h}{H}}
\uncover<8-9>{\nccurve[linecolor=cyan]{->}{h}{I}}
\uncover<9>{\nccurve[linecolor=olive]{->}{j}{J}}
\uncover<9>{\nccurve[linecolor=olive]{->}{j}{K}}
\uncover<10-11>{\nccurve[linecolor=teal]{->}{l}{L}}
\uncover<11>{\nccurve[linecolor=RedViolet]{->}{m}{M}}
\uncover<12>{\nccurve[linecolor=teal]{->}{n}{N}}
\uncover<12>{\nccurve[linecolor=teal]{->}{n}{O}}

\end{frame}

\subsection{Format Solutions}

\begin{frame}[t,fragile]

\begin{block}<1->{}
\scriptsize
\begin{lstlisting}[language=Perl,inputencoding=latin9,escapeinside={(*@}{@*)}]
sub _build_exercises {
    ( $a, $b ) = ( $a->(*@\pnode(0,0){A1}{}@*)_reduce, $b = (*@\pnode(0,0){A2}{}@*)$b->_reduce );
    push (*@\pnode(0,0){B}{}@*)@way, sprintf( '%s %s %s', $a, $op, $b )
      if ( $a->num !=(*@\pnode(0,0){C}{}@*) $line->[$i]->[0]->num or $b->num != ... );

    my $(*@\pnode(0,0){F}{}@*)gcd = VulFrac->new( num => $a->denum, denum => $b->denum )->_gcd;
    my ( $fa, $fb ) = ( $b->{denum} / $gcd, $a->{denum} / $gcd );
    push @way, (*@\pnode(0,0){G}{}@*)sprintf( '\frac{%d \cdot %d}{%d \cdot %d} %s ...',
               $a->num, $fa, $a->denum, $fa, $op, $b->num, $fb, ... );
    push @way, (*@\pnode(0,0){H}{}@*)sprintf( '\frac{%d}{%d} %s \frac{%d}{%d}',
               $a->num*$fa, $a->denum*$fa, $op, $b->num*$fb, $b->denum*$fb );
    push @way, (*@\pnode(0,0){J}{}@*)sprintf( '\frac{%d %s %d}{%d}',
               $a->num * $fa, $op, $b->num * $fb, $a->denum * $fa );
    my $s = (*@\pnode(0,0){K}{}@*)VulFrac->new( denum => $a->denum * $fa,
                  num => $i ? $a->num * $fa - $b->num * $fb : ...s/-/+/);
    push @way, "" . $s; my (*@\pnode(0,0){L}{}@*)$c = $s->_reduce; $c->num != $s->num and push @way, "" . $c;
    $c->num > $c->denum and $c->denum > 1 and push @way, $c->_stringify((*@\pnode(0,0){M}{}@*)1);

    push( @solution, '$ ' . (*@\pnode(0,0){N}{}@*)join( " = ", @way ) . ' $' );
}
\end{lstlisting}
\end{block}

\begin{itemize}
\uncover<2->{\item try to reduce \rnode{a}{\texttt{operands}} \uncover<3->{and \rnode{b}{add} them to opening \uncover<4->{when \rnode{c}{successful}}}}
\uncover<5->{\item World of Handcraft: show calculation method by \uncover<6->{determine \rnode{f}{geatest common divisor} of operands denominator,
             \uncover<7->{format \rnode{g}{subsequent} \uncover<8->{\rnode{h}{steps} to \rnode{j}{reach}
	     \uncover<9->{the \rnode{k}{solution}}}}}}
\uncover<10->{\item remark \rnode{l}{possible} reducing, \uncover<11->{\rnode{m}{mixed} fraction, \uncover<12->{\rnode{n}{cord} it and go ahead}}}
\end{itemize}
\uncover<2-4>{\nccurve[linecolor=teal]{->}{a}{A1}}
\uncover<2-4>{\nccurve[linecolor=teal]{->}{a}{A2}}
\uncover<3-4>{\nccurve[linecolor=cyan]{->}{b}{B}}
\uncover<4>{\nccurve[linecolor=RedViolet]{->}{c}{C}}
\uncover<5-9>{\nccurve[linecolor=teal]{->}{f}{F}}
\uncover<6-9>{\nccurve[linecolor=cyan]{->}{g}{G}}
\uncover<7-9>{\nccurve[linecolor=cyan]{->}{h}{H}}
\uncover<8-9>{\nccurve[linecolor=cyan]{->}{j}{J}}
\uncover<9>{\nccurve[linecolor=blue]{->}{k}{K}}
\uncover<10-12>{\nccurve[linecolor=teal]{->}{l}{L}}
\uncover<11-12>{\nccurve[linecolor=teal]{->}{m}{M}}
\uncover<12>{\nccurve[linecolor=blue]{->}{n}{N}}

\end{frame}

\renewcommand{\baselinestretch}{1.5}

\section{Created Exercise Output}

\subsection{Challenges}

\begin{frame}[t,fragile]

\begin{block}<1->{}

\footnotesize
\begin{longtable}[l]{p{5cm}|p{5cm}}
\toprule
Vulgar Fraction Addition & Vulgar Fraction Subtraction \\
\midrule
\endfirsthead

\toprule
Vulgar Fraction Addition & Vulgar Fraction Subtraction \\
\midrule
\endhead
\midrule
\multicolumn{2}{r}{{Continued on next page}} \\
\bottomrule
\endfoot

\caption{Fractions\label{vulgar_fractions_addition}}\\
\endlastfoot
$ \frac{99}{67} + \frac{43}{84} = $ & $ \frac{45}{41} - \frac{32}{48} = $ \\
$ \frac{19}{7} + \frac{16}{54} = $  & $ \frac{51}{47} - \frac{49}{65} = $ \\
$ \frac{38}{82} + \frac{38}{99} = $ & $ \frac{56}{33} - \frac{30}{32} = $ \\
$ \frac{96}{80} + \frac{46}{39} = $ & $ \frac{49}{79} - \frac{29}{82} = $ \\
$ \frac{72}{68} + \frac{46}{99} = $ & $ \frac{42}{49} - \frac{38}{59} = $ \\
\bottomrule
\end{longtable}

\end{block}

\end{frame}

\subsection{Solutions}

\begin{frame}[t,fragile]

\begin{block}<1->{}

\footnotesize
\begin{longtable}[l]{p{5cm}|p{5cm}}
\toprule
Vulgar Fraction Addition & Vulgar Fraction Subtraction \\
\midrule
\endfirsthead

\toprule
Vulgar Fraction Addition & Vulgar Fraction Subtraction \\
\midrule
\endhead
\midrule
\multicolumn{2}{r}{{Continued on next page}} \\
\bottomrule
\endfoot

\caption{Solution Fractions\label{solutionvulgar_fractions_addition}}\\
\endlastfoot
$ \frac{99}{67} + \frac{43}{84} = \frac{99 \cdot 84}{67 \cdot 84} + \frac{43 \cdot 67}{84 \cdot 67} = \frac{8316}{5628} + \frac{2881}{5628} = \frac{8316 + 2881}{5628} = \frac{11197}{5628} = \normalsize{1} \frac{5569}{5628} $                             & $ \frac{45}{41} - \frac{32}{48} = \frac{45}{41} - \frac{2}{3} = \frac{45 \cdot 3}{41 \cdot 3} - \frac{2 \cdot 41}{3 \cdot 41} = \frac{135}{123} - \frac{82}{123} = \frac{135 - 82}{123} = \frac{53}{123} $                                                \\
$ \frac{19}{7} + \frac{16}{54} = \frac{19}{7} + \frac{8}{27} = \frac{19 \cdot 27}{7 \cdot 27} + \frac{8 \cdot 7}{27 \cdot 7} = \frac{513}{189} + \frac{56}{189} = \frac{513 + 56}{189} = \frac{569}{189} = \normalsize{3} \frac{2}{189} $                    & $ \frac{51}{47} - \frac{49}{65} = \frac{51}{47} - \frac{49}{65} = \frac{51 \cdot 65}{47 \cdot 65} - \frac{49 \cdot 47}{65 \cdot 47} = \frac{3315}{3055} - \frac{2303}{3055} = \frac{3315 - 2303}{3055} = \frac{1012}{3055} $                              \\
$ \frac{38}{82} + \frac{38}{99} = \frac{19}{41} + \frac{38}{99} = \frac{19 \cdot 99}{41 \cdot 99} + \frac{38 \cdot 41}{99 \cdot 41} = \frac{1881}{4059} + \frac{1558}{4059} = \frac{1881 + 1558}{4059} = \frac{3439}{4059} $                                 & $ \frac{56}{33} - \frac{30}{32} = \frac{56}{33} - \frac{15}{16} = \frac{56 \cdot 16}{33 \cdot 16} - \frac{15 \cdot 33}{16 \cdot 33} = \frac{896}{528} - \frac{495}{528} = \frac{896 - 495}{528} = \frac{401}{528} $                                       \\
$ \frac{96}{80} + \frac{46}{39} = \frac{6}{5} + \frac{46}{39} = \frac{6 \cdot 39}{5 \cdot 39} + \frac{46 \cdot 5}{39 \cdot 5} = \frac{234}{195} + \frac{230}{195} = \frac{234 + 230}{195} = \frac{464}{195} = \normalsize{2} \frac{74}{195} $                & $ \frac{49}{79} - \frac{29}{82} = \frac{49 \cdot 82}{79 \cdot 82} - \frac{29 \cdot 79}{82 \cdot 79} = \frac{4018}{6478} - \frac{2291}{6478} = \frac{4018 - 2291}{6478} = \frac{1727}{6478} $                                                              \\
$ \frac{72}{68} + \frac{46}{99} = \frac{18}{17} + \frac{46}{99} = \frac{18 \cdot 99}{17 \cdot 99} + \frac{46 \cdot 17}{99 \cdot 17} = \frac{1782}{1683} + \frac{782}{1683} = \frac{1782 + 782}{1683} = \frac{2564}{1683} = \normalsize{1} \frac{881}{1683} $ & $ \frac{42}{49} - \frac{38}{59} = \frac{6}{7} - \frac{38}{59} = \frac{6 \cdot 59}{7 \cdot 59} - \frac{38 \cdot 7}{59 \cdot 7} = \frac{354}{413} - \frac{266}{413} = \frac{354 - 266}{413} = \frac{88}{413} $                                              \\
\bottomrule
\end{longtable}

\end{block}

\end{frame}

\part{Finish}

\section{Conclusion}

\begin{frame}[t,fragile]

\begin{block}<1->{Conclusion}
\begin{itemize}
\item lazy attributes allow designing a multi-stage initialization phase
\uncover<2->{\item benefit of common runtime (faster load) when using}
\uncover<3->{
\begin{itemize}
\item DBIx::Class
\item Web::Simple (Jedi)
\end{itemize}}
\uncover<4->{\item improve design by}
\begin{itemize}
\uncover<5->{\item using roles for behavioral design (avoid duck typing)}
\uncover<6->{\item using explicit patterns for clear separation of concerns}
\uncover<6->{\item express intensions clearer for method overloading by using \textit{method modifiers}}
\end{itemize}
\end{itemize}
\end{block}

\end{frame}

%\begin{frame}[t,fragile]

%\begin{block}<n->{}
%\begin{itemize}
%\item
%\end{itemize}
%\end{block}

%\end{frame}

\section{Resources}

\subsection{Resources}

% RESOURCES
\begin{frame}[t,fragile]{Resources}
\begin{block}<1->{Software}
\url{https://metacpan.org/pod/Moo/} \\
\url{https://github.com/moose/Moo} \\
\url{https://metacpan.org/search?q=MooX} \\
\url{https://metacpan.org/pod/MooX::Cmd} \\
\url{https://metacpan.org/pod/MooX::Options} \\
\url{https://metacpan.org/pod/MooX::ConfigFromFile} \\
\url{https://github.com/rehsack/App-Math-Tutor}
\end{block}

\begin{block}<2->{IRC}
\url{irc://irc.perl.org/#moose} \\
\url{irc://irc.perl.org/#web-simple}
\end{block}
\end{frame}

\subsection{Thank you}

% THANKS
\begin{frame}[fragile]{Thank You For Listening}
\begin{block}<1->{Questions?}
Jens Rehsack \textless{}\href{mailto:rehsack@cpan.org}{rehsack@cpan.org}\textgreater{}
\end{block}
\end{frame}

\end{document}
